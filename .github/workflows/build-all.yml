name: Build All Platforms

on:
  workflow_dispatch:
    inputs:
      ios_build:
        description: 'Build iOS?'
        required: true
        default: true
        type: boolean
      android_build:
        description: 'Build Android?'
        required: true
        default: true
        type: boolean
      build_type:
        description: 'Build type'
        required: true
        default: 'production'
        type: choice
        options:
          - production
          - development

jobs:
  ios-build:
    name: Build iOS App
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.ios_build }}
    steps:
      - name: ğŸ— Setup repository
        uses: actions/checkout@v4

      - name: ğŸ— Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18.x
          cache: npm

      - name: ğŸ— Setup EAS
        uses: expo/expo-github-action@v8
        with:
          eas-version: latest
          token: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“¦ Install dependencies
        run: npm install

      - name: ğŸš€ Build iOS app
        run: eas build --platform ios --profile ${{ github.event.inputs.build_type }} --non-interactive --no-wait
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“± iOS Build info
        run: |
          echo "âœ… iOS build spuÅ¡tÄ›n ÃºspÄ›Å¡nÄ›!"
          echo "ğŸ”§ Build type: ${{ github.event.inputs.build_type }}"
          echo "ğŸ“± Platform: iOS"
          echo "â³ Build bÄ›Å¾Ã­ na pozadÃ­..."

  android-build:
    name: Build Android AAB
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.android_build }}
    steps:
      - name: ğŸ— Setup repository
        uses: actions/checkout@v4

      - name: ğŸ— Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18.x
          cache: npm

      - name: ğŸ— Setup EAS
        uses: expo/expo-github-action@v8
        with:
          eas-version: latest
          token: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“¦ Install dependencies
        run: npm install

      - name: ğŸš€ Build Android AAB
        run: eas build --platform android --profile ${{ github.event.inputs.build_type }} --non-interactive --no-wait
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“± Android Build info
        run: |
          echo "âœ… Android AAB build spuÅ¡tÄ›n ÃºspÄ›Å¡nÄ›!"
          echo "ğŸ”§ Build type: ${{ github.event.inputs.build_type }}"
          echo "ğŸ“± Platform: Android"
          echo "ğŸ“¦ Output: AAB soubor"
          echo "â³ Build bÄ›Å¾Ã­ na pozadÃ­..."

  summary:
    name: Build Summary
    runs-on: ubuntu-latest
    needs: [ios-build, android-build]
    if: always()
    steps:
      - name: ğŸ“‹ Build Summary
        run: |
          echo "ğŸ¯ Build Summary:"
          echo "=================="
          if [ "${{ github.event.inputs.ios_build }}" == "true" ]; then
            echo "âœ… iOS build: SpuÅ¡tÄ›n"
          else
            echo "âŒ iOS build: PÅ™eskoÄen"
          fi
          
          if [ "${{ github.event.inputs.android_build }}" == "true" ]; then
            echo "âœ… Android build: SpuÅ¡tÄ›n"
          else
            echo "âŒ Android build: PÅ™eskoÄen"
          fi
          
          echo "ğŸ”§ Build type: ${{ github.event.inputs.build_type }}"
          echo "ğŸ“± VÅ¡echny buildy byly spuÅ¡tÄ›ny ÃºspÄ›Å¡nÄ›!"
